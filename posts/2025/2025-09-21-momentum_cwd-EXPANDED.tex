

\documentclass[11pt,letterpaper]{article}

\newcommand{\workingDate}{\textsc{2025 $|$ September $|$ 21}}
\newcommand{\userName}{Research Student}
\newcommand{\institution}{University} 

\ProvidesPackage{diary_base}


\usepackage[comma,numbers]{natbib}          \usepackage{fancyhdr}                       \usepackage[utf8]{inputenc}                 \usepackage[hmargin=2cm,vmargin=2.5cm]{geometry}  

\usepackage{amsmath}                        \usepackage{amsfonts}                       \usepackage{amssymb}                        \usepackage{amsthm}                         \usepackage{mathtools}                      

\usepackage{graphicx}                       \usepackage{epsfig}                         \usepackage{wrapfig}                        

\usepackage{textcomp}                       \PassOptionsToPackage{dvipsnames}{xcolor}   \usepackage{xcolor}                         \usepackage{multirow}                       \usepackage[normalem]{ulem}                 \usepackage{soul}                           

\usepackage{framed}                         \usepackage{booktabs}                       \usepackage{tcolorbox}                      \usepackage{comment}                        

\usepackage{algorithm}                      \usepackage{algorithmic}                    

\PassOptionsToPackage{framemethod=TikZ}{mdframed}  \usepackage{mdframed}                       \mdfsetup{skipabove=1em,skipbelow=0em}

\usepackage[inner, inline, left]{showlabels}  

\usepackage{scalerel}                       

\definecolor{darkblue}{RGB}{47,68,117}
\definecolor{lightgray}{gray}{0.95}
\usepackage{hyperref}
\hypersetup{
    pdftitle={Research Diary},
    pdfauthor={\userName \; (\institution)},
    pdfsubject={Research Diary},
    colorlinks=true,
    linkcolor=darkblue,
    citecolor=green,
    filecolor=magenta,
    urlcolor=blue
}

\pagestyle{fancy}
\setlength\parindent{0in}
\setlength\parskip{0.1in} 
\setlength\headheight{15pt}

\rhead{\workingDate}
\chead{\textsc{Research Diary}}
\lhead{\textsc{\userName}}
\rfoot{\textsc{\thepage}}
\cfoot{\textit{Last modified: \today}}
\lfoot{\textsc{\institution}}

\newtheorem{thm}{Theorem}[section]
\newtheorem{cor}[thm]{Corollary}
\newtheorem{mydef}[thm]{Definition}
\newtheorem{lem}[thm]{Lemma} 
\newtheorem{fac}[thm]{Fact} 
\newtheorem{cla}[thm]{Claim} 
\newtheorem{exa}[thm]{Example} 
\newtheorem{ass}[thm]{Assumption}
\newtheorem{pro}[thm]{Proposition}

\newtheorem{theorem}[thm]{Theorem}
\newtheorem{corollary}[thm]{Corollary}
\newtheorem{definition}[thm]{Definition}
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{fact}[thm]{Fact}
\newtheorem{claim}[thm]{Claim}
\newtheorem{example}[thm]{Example}
\newtheorem{assumption}[thm]{Assumption}
\newtheorem{proposition}[thm]{Proposition}

\begingroup
    \makeatletter
    \@for\theoremstyle:=definition,remark,plain\do{\expandafter\g@addto@macro\csname th@\theoremstyle\endcsname{\addtolength\thm@preskip\parskip
            }}
\endgroup

\newenvironment{fthm}{\hspace{1\baselineskip}\begin{mdframed}\hspace{-1\baselineskip}\begin{thm}} {\end{thm}\end{mdframed}}
\newenvironment{flem}{\hspace{1\baselineskip}\begin{mdframed}\hspace{-1\baselineskip}\begin{lem}} {\end{lem}\end{mdframed}}
\newenvironment{fcor}{\hspace{1\baselineskip}\begin{mdframed}\hspace{-1\baselineskip}\begin{cor}} {\end{cor}\end{mdframed}}
\newenvironment{fmydef}{\hspace{1\baselineskip}\begin{mdframed}\hspace{-1\baselineskip}\begin{mydef}} {\end{mydef}\end{mdframed}}
\newenvironment{fcla}{\hspace{1\baselineskip}\begin{mdframed}\hspace{-1\baselineskip}\begin{cla}} {\end{cla}\end{mdframed}}
\newenvironment{fpro}{\hspace{1\baselineskip}\begin{mdframed}\hspace{-1\baselineskip}\begin{pro}} {\end{pro}\end{mdframed}}
\newenvironment{ffac}{\hspace{1\baselineskip}\begin{mdframed}\hspace{-1\baselineskip}\begin{fac}} {\end{fac}\end{mdframed}}
\newenvironment{fexa}{\hspace{1\baselineskip}\begin{mdframed}\hspace{-1\baselineskip}\begin{exa}} {\end{exa}\end{mdframed}}\ProvidesPackage{diary_ctheorems}


\makeatletter

\@ifpackageloaded{thmtools}{}{\usepackage{thmtools}}
\@ifpackageloaded{mdframed}{}{\PassOptionsToPackage{framemethod=TikZ}{mdframed}\usepackage{mdframed}}

\theoremstyle{definition}

\newcommand{\definecolorbox}[2]{\expandafter\declaretheoremstyle\expandafter[headfont=\bfseries\sffamily\color{#1!70!black}, 
    bodyfont=\normalfont,
    mdframed={linewidth=2pt,
      rightline=false, 
      topline=false, 
      bottomline=false,
      linecolor=#1, 
      backgroundcolor=#1!5,
    }
  ]{#2}}

\definecolorbox{ForestGreen}{thmgreenbox}      \definecolorbox{NavyBlue}{thmbluebox}          \definecolorbox{RawSienna}{thmredbox}          \definecolorbox{LightPink!75!white}{thmpastelpinkbox}
\definecolorbox{Thistle!80!white}{thmpastelvioletbox}
\definecolorbox{Purple!75!white}{thmpurplebox}
\definecolorbox{Goldenrod!80!black}{thmgoldbox}
\definecolorbox{orange}{thmorangebox}          



\@ifundefined{cdefinition}{
  \declaretheorem[style=thmgreenbox, name=Definition]{cdefinition}
}{}

\@ifundefined{cremark}{
  \declaretheorem[style=thmgreenbox, numbered=no, name=Remark]{cremark*}
  \declaretheorem[style=thmgreenbox, name=Remark]{cremark}
}{}

\@ifundefined{cnote}{
  \declaretheorem[style=thmgreenbox, numbered=no, name=Note]{cnote*}
  \declaretheorem[style=thmgreenbox, name=Note]{cnote}
}{}

\declaretheorem[style=thmorangebox, name=Background]{background}
\declaretheorem[style=thmorangebox, numbered=no, name=Background]{background*}
\declaretheorem[style=thmorangebox, numbered=no, name=Notation]{notation*}
\declaretheorem[style=thmorangebox, name=Notation]{notation}

\@ifundefined{cexample}{
  \declaretheorem[style=thmbluebox, numbered=no, name=Example]{cexample*}
  \declaretheorem[style=thmbluebox, name=Example]{cexample}
}{}

\@ifundefined{cproposition}{
  \declaretheorem[style=thmredbox, name=Proposition]{cproposition} 
}{}

\@ifundefined{ctheorem}{
  \declaretheorem[style=thmredbox, name=Theorem]{ctheorem}
}{}

\@ifundefined{clemma}{
  \declaretheorem[style=thmredbox, name=Lemma]{clemma}
}{}

\@ifundefined{ccorollary}{
  \declaretheorem[style=thmredbox, name=Corollary]{ccorollary}
}{}



\newtheorem*{uovt}{UOVT}
\newtheorem*{previouslyseen}{As previously seen}
\newtheorem*{problem}{Problem}
\newtheorem*{observe}{Observe}
\newtheorem*{property}{Property}
\newtheorem*{intuition}{Intuition}



\declaretheoremstyle[
  headfont=\bfseries\sffamily\color{RawSienna!70!black}, 
  bodyfont=\normalfont,
  numbered=no,
  mdframed={
    linewidth=2pt,
    rightline=false, 
    topline=false, 
    bottomline=false,
    linecolor=RawSienna, 
    backgroundcolor=RawSienna!1,
  },
  qed=\qedsymbol
]{thmproofbox}

\declaretheoremstyle[
  headfont=\bfseries\sffamily\color{NavyBlue!70!black}, 
  bodyfont=\normalfont,
  numbered=no,
  mdframed={
    linewidth=2pt,
    rightline=false, 
    topline=false, 
    bottomline=false,
    linecolor=NavyBlue, 
    backgroundcolor=NavyBlue!1,
  }
]{thmexplanationbox}

\declaretheorem[style=thmproofbox, name=Proof]{cproof}

\declaretheorem[style=thmexplanationbox, name=Explanation]{tmpexplanation}
\newenvironment{explanation}[1][]{\vspace{-10pt}\begin{tmpexplanation}}{\end{tmpexplanation}}



\NewDocumentEnvironment{cbox}{O{blue} o}{
  \IfValueTF{#2}{\begin{mdframed}[
      linewidth=2pt,
      linecolor=#1,
      backgroundcolor=#1!5,
      rightline=false,
      topline=false,
      bottomline=false,
      innertopmargin=10pt,
      innerbottommargin=10pt,
      innerleftmargin=10pt,
      innerrightmargin=10pt,
      frametitle={\normalfont\sffamily\bfseries\color{#1!70!black} #2},
      frametitleaboveskip=5pt,
      frametitlealignment=\raggedright
    ]}{\begin{mdframed}[
      linewidth=2pt,
      linecolor=#1,
      backgroundcolor=#1!5,
      rightline=false,
      topline=false,
      bottomline=false,
      innertopmargin=10pt,
      innerbottommargin=10pt,
      innerleftmargin=10pt,
      innerrightmargin=10pt
    ]}}{
  \end{mdframed}
}

\makeatother

\ProvidesPackage{diary_commands}


\newcommand{\coloneq}{\mathrel{\mathop:}=}
\newcommand{\myf}[2]{\frac{\displaystyle #1}{\displaystyle #2}}
\newcommand{\myp}[2]{\frac{\displaystyle \partial #1}{\displaystyle \partial  #2}}
\newcommand{\myb}[1]{\mbox{\boldmath$#1$}}

\newcommand{\eqnref}[1]{Eqn.~\eqref{#1}}
\newcommand{\figref}[1]{Fig.~\ref{#1}}
\newcommand{\here}[1]{\url{#1}}

\newcommand{\Qiang}[1]{\textcolor{red}{#1}\\}
\newcommand{\qiang}[1]{\textcolor{red}{#1}}
\newcommand{\Todo}[1]{\textcolor{red}{TODO: #1}\\}
\newcommand{\todo}[1]{\textcolor{gray}{TODO: #1}}
\newcommand{\ant}[1]{~~~~~~~\text{\textcolor{magenta}{//#1}}}
\newcommand{\remark}[1]{\paragraph{Remark}#1}

\newcommand{\red}[1]{\textcolor{red}{#1}}
\newcommand{\med}[1]{\textcolor{magenta}{#1}}
\newcommand{\blue}[1]{\textcolor{blue}{#1}}
\newcommand{\gray}[1]{\textcolor{gray}{#1}}
\newcommand{\green}[1]{\textcolor{green}{#1}}
\newcommand{\myempty}[1]{}

\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\D}{\mathbb{D}}
\renewcommand{\P}{\mathcal{P}}
\renewcommand{\H}{\mathcal{H}}
\newcommand{\X}{\mathcal{X}}
\newcommand{\B}{\mathcal{B}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\M}{\mathbb{M}}

\newcommand{\var}{\mathrm{var}}
\newcommand{\Var}{\mathrm{Var}}
\newcommand{\cov}{\mathrm{cov}}
\newcommand{\Cov}{\mathrm{Cov}}
\newcommand{\corr}{\mathrm{corr}}
\newcommand{\Corr}{\mathrm{Corr}}
\newcommand{\pr}{\mathrm{Pr}}
\newcommand{\prob}{\mathrm{Pr}}
\newcommand{\normal}{\mathcal{N}}
\newcommand{\MSE}{\mathrm{MSE}}
\newcommand{\KL}{\mathrm{KL}}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\median}{\mathrm{med}}
\DeclareMathOperator*{\mode}{\mathrm{mod}}

\newcommand{\V}{\mathbf}
\newcommand{\vx}{\boldsymbol{x}}
\newcommand{\vv}[1]{\boldsymbol{#1}}
\newcommand{\trace}{\mathrm{trace}}
\newcommand{\diag}{\mathrm{diag}}
\renewcommand{\tt}{^\top}
\newcommand\norm[1]{\left\lVert#1\right\rVert}
\newcommand\abs[1]{\left\lvert#1\right\rvert}

\newcommand{\df}{\mathrm{d}}
\renewcommand{\d}{\mathrm{d}}
\newcommand{\dt}{\mathrm{d}t}
\newcommand{\dW}{\mathrm{d}W}
\newcommand{\dno}{\mathrm{d}}
\newcommand{\tdd}{\tilde{\nabla}}
\newcommand{\nablat}{\frac{\d}{\d t}}
\renewcommand{\div}{\nabla\cdot}
\newcommand\at[2]{\left.#1\right|_{#2}}

\newcommand{\sign}{\mathrm{sign}}
\newcommand{\cd}{\mid}
\newcommand{\neib}[1]{\partial{#1}}
\newcommand{\la}{\langle}
\newcommand{\ra}{\rangle}

\newcommand{\set}[1]{\mathcal{#1}}
\newcommand{\funcset}[1]{\mathcal{#1}}
\newcommand{\opt}[1]{\mathcal{#1}}
\newcommand{\f}[2]{\frac{#1}{#2}}

\newcommand{\sumstein}{\mathcal{T}}
\newcommand{\stein}{\mathcal{A}}
\newcommand{\score}{\vv{s}}
\newcommand{\ff}{\vv{\phi}}
\newcommand{\eng}{E}
\newcommand{\greedy}[1]{\mathrm{Greedy}\{#1\}}
\newcommand{\hattheta}{\hat{\theta}}
\newcommand{\cc}{\theta}
\newcommand{\kernel}{\mathbf{k}}
\newcommand{\datai}{^{(i)}}

\def\bb#1\ee{\begin{align*}#1\end{align*}}
\def\bba#1\eea{\begin{align}#1\end{align}}
\def\bbb#1\eee{\begin{align}#1\end{align}}

\newcommand{\clickhere}[1]{\href{run:#1}{Click here}}

\newcommand\reallywidehat[1]{\arraycolsep=0pt\relax \begin{array}{c}
\stretchto{
  \scaleto{
    \scalerel*[\widthof{\ensuremath{#1}}]{\kern-.5pt\bigwedge\kern-.5pt}
    {\rule[-\textheight/2]{1ex}{\textheight}}
  }{\textheight}
}{0.5ex}\\
#1\\
\rule{-1ex}{0ex}
\end{array}
}

\makeatletter
\newcommand{\defeq}{\mathrel{\aban@defeq}}
\newcommand{\aban@defeq}{\vbox{\offinterlineskip\check@mathfonts
    \ialign{\hfil##\hfil\cr
      \fontsize{\ssf@size}{\z@}\normalfont def\cr
      \noalign{\kern1\p@}
      $\m@th=$\cr
      \noalign{\kern-.5\fontdimen22\textfont2}
    }}}
\makeatother

\newcommand{\e}[1]{\E\left[#1\right]}


\begin{document}
\href{run:2025-09-21-momentum_cwd.tex}{\Huge September 21} 

\section{Momentum + Cautious WD}

\begin{align}
    \dot x = - m - \mathbb{I}(mx\geq 0) x \\ 
    \dot m = \nabla f(x) - m. 
\end{align}
$$
H(x, m) = f(x) + \frac{1}{2} m^2 + (mx)_+
$$

Let us use $s \in[0,1]$ to denote the subgradient of $(mx)_+$ within $H$. Let $p \in[0,1]$ be the Flippiov variable of $\mathbb{I}(mx \geq 0)$ inside the velocity field. Note that $s$ and $p$ are different. We need to keep track of it in the derivation. 
\begin{align*}
\dot H(s,p) &  =  g \dot x + m \dot m + s (m \dot x + x \dot m) \\ 
& = -g (m + p x) + m(g - m) + s (-m (m + p x) + x (g - m) )\\
& = - p x g - m^2 + s (- m^2 + xg - (1+p)xm)
\end{align*}

If $\alpha$ belongs to $\dot H$, we want that for each $s$, there exists $p$, such that 
$$
- p x g - m^2 + s (- m^2 + xg - (1+p)xm) = -\alpha.
$$
So we have 
$$
p (-xg - s x m ) - m^2 + s (-m^2 + xg - xm) = \alpha. 
$$
$$
p = \frac{\alpha -(1+s) m^2 + s (xg - xm)}{xg +  s xm}. 
$$
At the non-smooth point, we have $xm =0$, and it gives 
$$
p = \frac{\alpha -(1+s) m^2 + s (xg)}{xg}.  
$$
So $p$ is in range of 
$$
\frac{\alpha - 2m^2 + xg}{xg}, ~~~~ 
\frac{\alpha - m^2 }{xg}. 
$$
If $xg >0$, we have 
$$
m^2 \leq \alpha \leq m^2 + xg
$$
$$
\alpha \leq 2m^2 \leq \alpha + xg 
$$
So 
$$
2m^2  - xg \leq \alpha \leq 2 m^2
$$

$$\cap_{s} \cup_{p} \dot H(s, p).$$


For know the flippov system, the set valued Lie-derivation is defined as:
$$
\mathcal L_v H  =   
\{\alpha \colon \exists p, ~~~ s.t. ~~~ \dot H(s,p) = \alpha ~~~\forall s \in \partial H \}.
$$
So we want to find the $p$ such that the $\dot H(s,p)$ is independent with the choice of $s$. 

So to make it independent on $s$, we want 
$$
-m^2 + xg -(1+p)xm  = 0.
$$
This gives
\begin{align*}
\dot H 
& = -p(m^2 + (1+p) xm)- m^2 \\
& = -(1+p)m^2 - p(1+p) xm. 
\end{align*}

If $xm <0$, we have $p=0$, and hence $\dot H = - m^2$. 
Invariant set is $\{xm < 0, ~~ m=0\}$.

If $xm >0$, we have $p = 1$, and hence, $\dot H = -(2 m^2 + 2 (xm)_+)$. Invariant set is $\{xm=0, ~~ m=0\}.$

If $xm=0$, we have $\dot H = -(1+p) m^2$. Invariant set is $\{xm=0, m = 0\}$. 

Hence, the invariant set is included in 
$$
\{xm \leq 0, ~~ m = 0\}. 
$$

But since $m=0$, we have $xm\leq 0$ anyway. 


\section{General Fillipov From Scratch}

\begin{ctheorem}
Assume we have non-smooth function $V(x)$ with clark generalized gradient, and let $d$ be an update direction. We have 
\end{ctheorem} 
\begin{cproof} 
\begin{align*}
\lim_{\epsilon \to 0^+}\frac{V(x + \epsilon d) - V(x)}{\epsilon} 
= ... 
\end{align*}  
\end{cproof}   

\begin{thm}[Great Theorem]
    Yes, it is. 
\end{thm}
\begin{proof} 
    Yes. 
\end{proof}    

\begin{theorem}[Great Theorem]
    This is the second. 
\end{theorem}
\begin{proof}
    This is the best. 
\end{proof}     




\bibliographystyle{apalike} 
\bibliography{assets/bib/reference}
\end{document}
